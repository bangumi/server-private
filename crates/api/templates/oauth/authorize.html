<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        background: #f5f5f5;
        color: #1f2937;
      }
      .container {
        max-width: 720px;
        margin: 40px auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 28px rgba(15, 23, 42, 0.08);
        padding: 24px;
      }
      .title {
        margin: 0 0 12px;
      }
      .muted {
        color: #6b7280;
      }
      .error {
        color: #b91c1c;
        background: #fee2e2;
        padding: 10px 12px;
        border-radius: 8px;
      }
      .scope {
        margin: 8px 0;
        padding-left: 18px;
      }
      .scope li {
        margin: 6px 0;
      }
      button {
        background: #f09199;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 10px 14px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <h1 class="title">{{ title }}</h1>

      {% if error %}
      <p class="error">{{ error }}</p>
      {% else %}
        {% if app and user and creator and client and csrf_token %}
          <p>
            <strong>{{ app.app_name }}</strong>
            <span class="muted">by {{ creator.nickname }}</span>
          </p>
          <p class="muted">{{ app.app_desc }}</p>

          <p>
            即将授权访问用户
            <strong>{{ user.nickname }}</strong>
            的账户信息。
          </p>

          <ul class="scope">
            <li>读取账户基本信息</li>
            {% for scope in scopes %}
              <li>
                {% if scope.mode == "write" %}
                  [读写]
                {% else %}
                  [只读]
                {% endif %}
                {{ scope.description }}
              </li>
            {% endfor %}
          </ul>

          <form method="post" action="/oauth/authorize">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
            <input type="hidden" name="client_id" value="{{ client.client_id }}" />
            <input type="hidden" name="redirect_uri" value="{{ client.redirect_uri }}" />
            <input type="hidden" name="scope" value="{{ scope_raw }}" />
            {% if state %}
              <input type="hidden" name="state" value="{{ state }}" />
            {% endif %}
            <button type="submit">授权</button>
          </form>
        {% else %}
          <p class="error">OAuth authorize page missing required context.</p>
        {% endif %}
      {% endif %}
    </main>
  </body>
</html>
